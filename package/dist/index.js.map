{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///./package/src/index.tsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","require","middlewareMap","Map","oldStateMap","stateChangeMap","createStateContext","initialState","middlewares","contextObject","react__WEBPACK_IMPORTED_MODULE_0__","state","set","StateContextProvider","props","context","stateInitial","_a","setState","has","runMiddlewares","method","log","forEach","fn","setStatePartial","stateChange","errorStack","newState","__assign","oldState","stack","Error","split","slice","map","line","trim","replace","caller","useStateFn","keys","stateKey","stateValue","val","useState","Provider","children","useContextState","useObject","prevFile","prevLine","theLine","some","index","startsWith","match","stackFile"],"mappings":"6DACA,IAAAA,EAAA,GAGA,SAAAC,oBAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,GAAA,CACAG,EAAAH,EACAI,GAAA,EACAH,QAAA,IAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,qBAGAG,EAAAE,GAAA,EAGAF,EAAAD,QA0DA,OArDAF,oBAAAQ,EAAAF,EAGAN,oBAAAS,EAAAV,EAGAC,oBAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,oBAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,oBAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,eAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,cAAiDmB,OAAA,KAQjDrB,oBAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,oBAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,oBAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAArB,oBAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,oBAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,KAAAqB,WACA,SAAAM,aAA2B,OAAA3B,EAAA,SAC3B,SAAA4B,mBAAiC,OAAA5B,GAEjC,OADAH,oBAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,oBAAAa,EAAA,SAAAmB,EAAAC,GAAsD,OAAAnB,OAAAoB,UAAAC,eAAA5B,KAAAyB,EAAAC,IAGtDjC,oBAAAoC,EAAA,GAIApC,wCAAAqC,EAAA,mBClFAlC,EAAAD,QAAAoC,QAAA,ybCgCMC,EAAgB,IAAIC,IACpBC,EAAc,IAAID,IAClBE,EAAiB,IAAIF,IAEpB,SAASG,mBAA+CC,EAAsBC,GACjF,IAAMC,EAAgBhC,OAAAiC,EAAA,cAAAjC,CAA6B,CAAEkC,MAAOJ,IAE5D,OADAC,GAAeN,EAAcU,IAAIH,EAAeD,GACzCC,EAGJ,IAAMI,EAAgD,SAAAC,GACzD,IAAMC,EAAUD,EAAMC,QAChBC,EAAevC,OAAAiC,EAAA,WAAAjC,CAAWsC,GAASJ,MACnCM,EAAAxC,OAAAiC,EAAA,SAAAjC,CAAAuC,GAACL,EAAAM,EAAA,GAAOC,EAAAD,EAAA,GACRT,EAAcN,EAAciB,IAAIJ,GAAWb,EAActB,IAAImC,GAAW,GAExEK,EAAiB,SAACC,EAAsCC,GAC1Dd,EAAYe,QAAQ,SAAApD,GAChB,IAAMqD,EAAerD,EAAEkD,GACnBG,GACAA,EAAGF,MAKTG,EAAkB,SAACC,GACrB,IA8EOC,EA9EDC,EAAQC,EAAA,GAAQlB,EAAUe,GAE1BJ,EAAM,CACRI,YAAWA,EACXI,SAAUnB,EACViB,SAAQA,EACRG,OAwEGJ,GAxEU,IAAIK,OAAQD,MAyE1BJ,EACFM,MAAM,MACNC,MAAM,GACNC,IAAI,SAAAC,GAAQ,OAAAA,EAAKC,OAAOC,QAAQ,QAAS,OA3EtCC,OAAQA,QAAO,IAAKP,OAASD,QAGjCX,EAAe,iBAAkBE,GACjCjB,EAAeO,IAAIG,EAAOc,EAAA,GAAOxB,EAAezB,IAAImC,IAAY,GAAOW,IACvER,EAASU,GACTR,EAAe,gBAAiBE,IAG9BkB,EAAkB,GAExB/D,OAAOgE,KAAK9B,GAAOY,QAAQ,SAAAmB,GACvB,IAAIC,EAAahC,EAAM+B,GAQvBF,EAAWE,GAAY,CAACC,EANL,SAACC,SAChBnB,IAAeR,EAAA,IACVyB,GAAWE,UAOxB,IAAM5D,EAAQ,CACV2B,MAAKA,EACLO,SAAUO,EACVoB,SAAUL,GAGRV,EAAW1B,EAAYxB,IAAImC,GAE3BW,EAAcrB,EAAezB,IAAImC,GAYvC,OALAK,EAAe,mBALH,CACRU,SAAQA,EACRF,SAAUjB,EACVe,YAAWA,IAIftB,EAAYQ,IAAIG,EAASJ,GACzBN,EAAeO,IAAIG,EAAS,IAGxBL,EAAA,cAACI,EAAMC,QAAQ+B,SAAQ,CAAC9D,MAAOA,GAC1B8B,EAAMiC,WAKZ,SAASC,gBAAwBvC,GAGpC,IAAMM,EAAUtC,OAAAiC,EAAA,WAAAjC,CAAWgC,GACrBE,EAAaI,EAAQJ,MACrBO,EAAWH,EAAQG,SACnB+B,EAAiB,GAYvB,OAVAxE,OAAOgE,KAAK9B,GAAOY,QAAQ,SAAAmB,GACvB,IAAMC,EAAahC,EAAM+B,GAOzBO,EAAUP,GAAY,CAACC,EANJ,SAACC,SAChB1B,EAAQW,EAAA,GACDlB,IAAKM,EAAA,IACFyB,GAAWE,EAAG3B,SAKzBgC,EAUX,SAASV,OAAOZ,GACZ,IAEIuB,EACAC,EACAC,EA+BJ,OAnCczB,EAAWM,MAAM,MAAMC,MAAM,GAMxBmB,KAAK,SAACjB,EAAMkB,GAG3B,MAFAlB,EAAOA,EAAKC,QAGFkB,WAAW,uBACbnB,EAAKmB,WAAW,8BAChBnB,EAAKmB,WAAW,kBAChBnB,EAAKmB,WAAW,yBAChBnB,EAAKoB,MAAM,oBACjB,CACE,IACMC,KADarB,EAAKoB,MAAM,gBAAkB,IAAI,IAAM,IAC7BA,MAAM,yBAA0B,IAAI,GAEjE,GAAIL,GAAYM,GAAaA,IAAcP,EAEvC,OADAE,EAAUD,GACH,EAGXD,EAAWO,EACXN,EAAWf,EAEf,OAAO,MAIPgB,EAAUD,GAGGC,EAAQd,QAAQ,UAAW","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"react\");","import * as React from 'react';\n\nimport {\n    createContext,\n    useContext,\n    useState,\n    Context,\n    SFC\n} from \"react\";\n\ninterface Store<TState = Partial<{}>> {\n    state: TState;\n    setState: (newState: Partial<TState>) => void;\n    useState: {\n        [P in keyof TState]: [TState[P], (newValue: Partial<TState[P]>) => void];\n    };\n}\n\ninterface StateProviderProps {\n    context: Context<Store<any>>;\n}\n\nexport interface StateContextMiddleware<TState = Partial<{}>> {\n    beforeSetState?: (log: { stateChange: Partial<TState>, oldState: TState, newState: TState, stack: string[], caller: string }) => void,\n    afterSetState?: (log: { stateChange: Partial<TState>, oldState: TState, newState: TState, stack: string[], caller: string }) => void,\n    newProviderValue?: (log: { stateChange: Partial<TState>, oldState: TState, newState: TState }) => void\n}\n\ntype StateContextMiddlewareMethod = keyof StateContextMiddleware<Partial<{}>>;\n\ntype StateContextMiddlewares = StateContextMiddleware<Partial<{}>>[];\n\nconst middlewareMap = new Map<Context<Store<any>>, StateContextMiddlewares>();\nconst oldStateMap = new Map<Context<Store<any>>, Partial<{}>>();\nconst stateChangeMap = new Map<Context<Store<any>>, Partial<{}>>();\n\nexport function createStateContext<TState extends Partial<{}>>(initialState: TState, middlewares?: StateContextMiddlewares) {\n    const contextObject = createContext<Store<TState>>({ state: initialState } as Store<TState>);\n    middlewares && middlewareMap.set(contextObject, middlewares);\n    return contextObject;\n};\n\nexport const StateContextProvider: SFC<StateProviderProps> = props => {\n    const context = props.context;\n    const stateInitial = useContext(context).state;\n    const [state, setState] = useState(stateInitial);\n    const middlewares = middlewareMap.has(context) ? middlewareMap.get(context) : [];\n\n    const runMiddlewares = (method: StateContextMiddlewareMethod, log: any) => {\n        middlewares.forEach(m => {\n            const fn: Function = m[method];\n            if (fn) {\n                fn(log);\n            }\n        });\n    };\n\n    const setStatePartial = (stateChange: Partial<{}>) => {\n        const newState = { ...state, ...stateChange };\n\n        const log = {\n            stateChange,\n            oldState: state,\n            newState,\n            stack: stack(new Error().stack),\n            caller: caller((new Error()).stack)\n        };\n\n        runMiddlewares('beforeSetState', log);\n        stateChangeMap.set(context, { ...stateChangeMap.get(context) || {}, ...stateChange });\n        setState(newState);\n        runMiddlewares('afterSetState', log);\n    };\n\n    const useStateFn: any = {};\n\n    Object.keys(state).forEach(stateKey => {\n        let stateValue = state[stateKey];\n\n        const setStateFn = (val: any) => {\n            setStatePartial({\n                [stateKey]: val\n            });\n        };\n\n        useStateFn[stateKey] = [stateValue, setStateFn];\n    });\n\n    const value = {\n        state,\n        setState: setStatePartial,\n        useState: useStateFn\n    };\n\n    const oldState = oldStateMap.get(context);\n\n    const stateChange = stateChangeMap.get(context);\n\n    const log = {\n        oldState,\n        newState: state,\n        stateChange\n    };\n    runMiddlewares('newProviderValue', log);\n\n    oldStateMap.set(context, state);\n    stateChangeMap.set(context, {});\n\n    return (\n        <props.context.Provider value={value}>\n            {props.children}\n        </props.context.Provider>\n    );\n};\n\nexport function useContextState<TState>(contextObject: Context<Store<TState>>): {\n    [P in keyof TState]: [TState[P], (newValue: Partial<TState[P]>) => void];\n} {\n    const context = useContext(contextObject);\n    const state: any = context.state;\n    const setState = context.setState;\n    const useObject: any = {};\n\n    Object.keys(state).forEach(stateKey => {\n        const stateValue = state[stateKey];\n        const setStateFn = (val: any) => {\n            setState({\n                ...state,\n                ...{ [stateKey]: val }\n            });\n        };\n        useObject[stateKey] = [stateValue, setStateFn];\n    });\n    return useObject;\n}\n\nfunction stack(errorStack: string) {\n    return errorStack\n        .split('\\n')\n        .slice(1)\n        .map(line => line.trim().replace(/^at */, ''));\n}\n\nfunction caller(errorStack: string) {\n    const lines = errorStack.split('\\n').slice(1);\n\n    let prevFile: string;\n    let prevLine: string;\n    let theLine: string;\n\n    const some = lines.some((line, index) => {\n        line = line.trim();\n\n        if (\n            !line.startsWith('at setStatePartial')\n            && !line.startsWith('at Object.setStatePartial')\n            && !line.startsWith('at setStateFn')\n            && !line.startsWith('at Object.setStateFn')\n            && !line.match(/\\(<anonymous>\\)/)\n        ) {\n            const stackPath = (line.match(/\\(([^)]+)\\)/) || [])[1] || '';\n            const stackFile = (stackPath.match(/\\/([^:/]+):\\d+:\\d+$/) || [])[1];\n\n            if (prevLine && stackFile && stackFile !== prevFile) {\n                theLine = prevLine;\n                return true;\n            }\n\n            prevFile = stackFile;\n            prevLine = line;\n        }\n        return false;\n    });\n\n    if (!some) {\n        theLine = prevLine;\n    }\n\n    let callerName = theLine.replace(/^ *at */, '');\n    return callerName;\n}\n"],"sourceRoot":""}